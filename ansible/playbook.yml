---
- name: Install MySQL
  
  vars:
    mysql.user: daniel
    mysql.password: daniel
    mysql.host: frncesnapora01.sd.galderma.com
    mysql.db: daniel_db1
    mysql.privileges: ALL
    
  tasks:
    - name: Install MySQL repo
      yum: name=http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm state=present

    - name: install MySQL
      yum: name={{item}} state=present
      with_items:
        - mysql
        - mysql-server
      tags:
        - mysql
        - mysql-service

    - name: run MySQL
      service: name=mysqld state=started enabled=yes
      tags:
        - mysql
        - mysql-service

    - name: install required python MySQLdb lib to create databases and users
      yum: name={{item}} state=present
      with_items:
        - gcc-c++
        - MySQL-python
      tags:
        - mysql
        - mysql-dependencies

    - name: create db user
      mysql_user: name={{mysql.user}} password={{mysql.password}} priv={{mysql.privileges}} host={{mysql.host}} state=present
      tags:
        - mysql
        - mysql-user

    - name: create mysql database
      mysql_db: name={{mysql.db}} state=present
      tags:
        - mysql
        - mysql-db

    - name: bind mysql remote address
      ini_file: dest=/etc/my.cnf
            section=mysqld
            option=bind-address
            value={{item}}
      with_items: mysql.bind
      tags:
        - mysql
        - mysql-configure
      notify:
        - restart mysql
